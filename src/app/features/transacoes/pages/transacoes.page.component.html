<section class="animate-fade-in space-y-6">
  <div class="bg-slate-900 border border-white/10 p-6 rounded-3xl shadow-xl">
    <div class="flex items-center justify-between mb-4">
      <h2
        class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400"
      >
        Nova Movimentação
      </h2>
      <button
        type="button"
        (click)="exportarCSV()"
        class="px-4 py-2 text-xs font-bold bg-slate-800 hover:bg-slate-700 text-white rounded-full transition shadow-lg border border-white/10"
      >
        Exportar CSV
      </button>
    </div>
    <form
      (ngSubmit)="adicionarTransacao($event)"
      [formGroup]="transacaoForm"
      class="grid grid-cols-1 md:grid-cols-2 gap-4"
    >
      <app-campo-formulario rotulo="Descrição" [nomeControle]="'descricao'" [obrigatorio]="true">
        <input
          type="text"
          formControlName="descricao"
          placeholder="Ex: Mercado Semanal"
          class="w-full bg-slate-950 border border-slate-800 rounded-2xl px-4 py-3 text-white focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none transition shadow-inner"
        />
      </app-campo-formulario>
      <app-campo-formulario rotulo="Valor (R$)" [nomeControle]="'valor'" [obrigatorio]="true">
        <app-input-moeda formControlName="valor"></app-input-moeda>
      </app-campo-formulario>
      <app-campo-formulario rotulo="Data" [nomeControle]="'data'" [obrigatorio]="true">
        <app-input-data formControlName="data"></app-input-data>
      </app-campo-formulario>
      <app-campo-formulario
        rotulo="Categoria"
        [nomeControle]="'categoria'"
        [obrigatorio]="true"
        [mensagensErro]="{ categoriaNaoExistente: 'Categoria nova — será criada ao salvar' }"
      >
        <app-categoria-select
          formControlName="categoria"
          [obrigatorio]="true"
          [tocado]="transacaoForm.get('categoria')?.touched ?? false"
        ></app-categoria-select>
      </app-campo-formulario>
      <app-campo-formulario
        rotulo="Pagamento"
        [nomeControle]="'metodoPagamento'"
        [obrigatorio]="true"
      >
        <app-pagamento-select
          formControlName="metodoPagamento"
          [cartoes]="cartoes()"
          [obrigatorio]="true"
          [tocado]="transacaoForm.get('metodoPagamento')?.touched ?? false"
        ></app-pagamento-select>
      </app-campo-formulario>
      <div class="md:col-span-2 mt-2 flex items-center gap-2">
        <app-botao
          [tipo]="TipoBotaoEnum.Primario"
          [tamanho]="TamanhoBotaoEnum.Grande"
          [cheio]="true"
          tipoHtml="submit"
          >{{ editandoId() ? 'Salvar Edição' : 'Confirmar Gasto' }}</app-botao
        >
        <app-botao
          *ngIf="editandoId()"
          [tipo]="TipoBotaoEnum.Texto"
          [tamanho]="TamanhoBotaoEnum.Medio"
          (aoClicar)="cancelarEdicaoTransacao()"
          [classeExtra]="'text-slate-400 hover:text-yellow-500'"
          >Cancelar</app-botao
        >
      </div>
    </form>
  </div>
  <div>
    <h3 class="text-lg font-bold text-white mb-3 px-2 flex items-center justify-between">
      <span>Histórico {{ filtroTodoPeriodo() ? 'Completo' : 'do Mês' }}</span>
      <div [formGroup]="filtroForm">
        <app-input-data [modo]="'mes'" formControlName="mes" [acoesRapidas]="true"></app-input-data>
      </div>
    </h3>
    <div class="space-y-3">
      <div
        *ngFor="let t of transacoesFiltradas()"
        class="bg-slate-900/50 border border-white/5 p-4 rounded-3xl flex justify-between items-center hover:bg-slate-800/50 transition"
      >
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-xl shadow-inner"
          >
            {{ getIconeCategoria(t.categoria) }}
          </div>
          <div>
            <p class="font-medium text-white">{{ t.descricao }}</p>
            <p class="text-xs text-slate-500 flex items-center gap-1">
              <span>{{ t.data | date: 'dd/MM/yyyy' }}</span> •
              <span
                class="px-2 py-0.5 rounded-full bg-slate-800 text-slate-300 text-[10px] uppercase font-bold tracking-wide"
                >{{ getNomeMetodo(t.metodoPagamento) }}</span
              >
              <span
                *ngIf="t.origemFixoId"
                class="px-2 py-0.5 rounded-full bg-purple-900/50 text-purple-300 text-[9px] border border-purple-500/30"
                >FIXO</span
              >
            </p>
          </div>
        </div>
        <div class="text-right">
          <p class="font-bold text-red-400">- {{ t.valor | currency: 'BRL' }}</p>
          <div class="flex items-center justify-end gap-3 mt-1">
            <button
              (click)="iniciarEdicaoTransacao(t)"
              class="text-[10px] text-slate-600 hover:text-yellow-500 underline"
            >
              Editar
            </button>
            <button
              (click)="removerTransacao(t.id)"
              class="text-[10px] text-slate-600 hover:text-red-500 underline"
            >
              Excluir
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="transacoesFiltradas().length === 0" class="text-center py-10 text-slate-600">
        Nenhuma transação encontrada.
      </div>
    </div>
  </div>
</section>
