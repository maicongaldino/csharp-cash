<section class="animate-fade-in space-y-6">
  <div class="flex flex-col md:flex-row gap-6">
    <div
      class="w-full md:w-1/3 bg-slate-900 border border-white/10 p-6 rounded-3xl h-fit shadow-xl"
    >
      <h2 class="text-xl font-bold mb-4 text-purple-400">
        {{ editandoId() ? 'Editar Gasto Fixo' : 'Novo Gasto Fixo' }}
      </h2>
      <form (ngSubmit)="adicionarGastoFixo($event)" [formGroup]="fixoForm" class="space-y-4">
        <app-campo-formulario
          rotulo="Descri√ß√£o"
          [nomeControle]="'descricao'"
          [obrigatorio]="true"
          [idInput]="'descFix'"
        >
          <input
            id="descFix"
            type="text"
            formControlName="descricao"
            class="w-full bg-slate-950 border border-slate-800 rounded-2xl px-4 py-3 text-white focus:border-purple-500 outline-none transition shadow-inner"
          />
        </app-campo-formulario>
        <app-campo-formulario
          rotulo="Valor (R$)"
          [nomeControle]="'valor'"
          [obrigatorio]="true"
          [idInput]="'valFix'"
        >
          <app-input-moeda id="valFix" formControlName="valor"></app-input-moeda>
        </app-campo-formulario>
        <app-campo-formulario
          rotulo="Dia Vencimento"
          [nomeControle]="'diaVencimento'"
          [obrigatorio]="true"
          [idInput]="'diaFix'"
        >
          <input
            id="diaFix"
            type="number"
            min="1"
            max="31"
            formControlName="diaVencimento"
            appSomenteNumeros
            class="w-full bg-slate-950 border border-slate-800 rounded-2xl px-4 py-3 text-white focus:border-purple-500 outline-none transition shadow-inner"
          />
        </app-campo-formulario>
        <app-campo-formulario
          rotulo="Vigente at√© (m√™s)"
          [nomeControle]="'vigenteAte'"
          [obrigatorio]="false"
        >
          <app-input-data [modo]="'mes'" formControlName="vigenteAte"></app-input-data>
        </app-campo-formulario>
        <app-campo-formulario
          rotulo="Categoria"
          [nomeControle]="'categoria'"
          [obrigatorio]="true"
          [mensagensErro]="{ categoriaNaoExistente: 'Categoria nova ‚Äî ser√° criada ao salvar' }"
        >
          <app-categoria-select
            formControlName="categoria"
            [obrigatorio]="true"
            [tocado]="fixoForm.get('categoria')?.touched ?? false"
          ></app-categoria-select>
        </app-campo-formulario>
        <app-campo-formulario
          rotulo="Forma Padr√£o"
          [nomeControle]="'metodoPagamento'"
          [obrigatorio]="true"
        >
          <app-pagamento-select
            formControlName="metodoPagamento"
            [cartoes]="cartoes()"
            [obrigatorio]="true"
            [tocado]="fixoForm.get('metodoPagamento')?.touched ?? false"
          ></app-pagamento-select>
        </app-campo-formulario>
        <div class="flex items-center gap-2">
          <app-botao
            [tipo]="TipoBotaoEnum.Primario"
            [tamanho]="TamanhoBotaoEnum.Grande"
            [cheio]="true"
            tipoHtml="submit"
            >{{ editandoId() ? 'Salvar Edi√ß√£o' : 'Salvar Fixo' }}</app-botao
          >
          <app-botao
            *ngIf="editandoId()"
            [tipo]="TipoBotaoEnum.Texto"
            [tamanho]="TamanhoBotaoEnum.Medio"
            (aoClicar)="cancelarEdicaoFixo()"
            [classeExtra]="'text-slate-400 hover:text-yellow-500'"
            >Cancelar</app-botao
          >
        </div>
      </form>
    </div>
    <div class="flex-1 space-y-4">
      <h3 class="text-lg font-bold text-white flex justify-between items-center px-2">
        <span>Assinaturas & Contas ({{ fixosComStatus().length }})</span>
        <div class="flex items-center gap-3">
          <div class="text-sm font-normal text-slate-400">
            Total: {{ totalFixos() | currency: 'BRL' }}
          </div>
          <div [formGroup]="filtroForm">
            <app-input-data [modo]="'mes'" formControlName="mes"></app-input-data>
          </div>
        </div>
      </h3>
      <div
        *ngFor="let fixo of fixosComStatus()"
        class="bg-slate-900/50 border border-white/5 p-4 rounded-3xl flex flex-col sm:flex-row justify-between items-center gap-4 transition hover:bg-slate-800/30 group"
      >
        <div class="flex items-center gap-4 w-full sm:w-auto">
          <div
            class="w-12 h-12 rounded-2xl flex items-center justify-center text-2xl bg-slate-800 text-slate-300 shadow-md group-hover:scale-110 transition"
          >
            {{
              fixo.categoria === 'Streaming'
                ? 'üì∫'
                : fixo.categoria === 'Casa'
                  ? 'üè†'
                  : fixo.categoria === 'Educacao'
                    ? 'üéì'
                    : 'üìÑ'
            }}
          </div>
          <div>
            <p class="font-bold text-white text-lg">{{ fixo.descricao }}</p>
            <p class="text-xs text-slate-500">
              Dia {{ fixo.diaVencimento }} ‚Ä¢ {{ getNomeMetodo(fixo.metodoPagamento) }}
            </p>
          </div>
        </div>
        <div class="flex items-center gap-4 w-full sm:w-auto justify-between sm:justify-end">
          <span class="font-bold text-white text-xl">{{ fixo.valor | currency: 'BRL' }}</span>
          <div class="flex items-center gap-2">
            <app-botao
              *ngIf="!fixo.pagoEsteMes"
              [tamanho]="TamanhoBotaoEnum.Pequeno"
              [tipo]="TipoBotaoEnum.Secundario"
              [classeExtra]="
                'bg-slate-800 hover:bg-green-600 hover:text-white text-green-500 border border-green-500/30 flex items-center gap-1 shadow-sm'
              "
              (aoClicar)="lancarGastoFixoNoHistorico(fixo)"
              title="Lan√ßar no hist√≥rico deste m√™s"
            >
              <span>Pagar</span>
            </app-botao>
            <div
              *ngIf="fixo.pagoEsteMes"
              class="bg-green-500/10 text-green-500 px-4 py-2 rounded-xl text-xs font-bold border border-green-500/20 flex items-center gap-1"
            >
              <span>‚úî Pago</span>
            </div>
            <app-botao
              [tamanho]="TamanhoBotaoEnum.Pequeno"
              [tipo]="TipoBotaoEnum.Texto"
              [classeExtra]="
                'text-slate-600 hover:text-red-500 px-3 py-2 rounded-xl hover:bg-red-500/10'
              "
              (aoClicar)="removerGastoFixo(fixo.id)"
            >
              üóë
            </app-botao>
            <app-botao
              [tamanho]="TamanhoBotaoEnum.Pequeno"
              [tipo]="TipoBotaoEnum.Texto"
              [classeExtra]="
                'text-slate-600 hover:text-yellow-500 px-3 py-2 rounded-xl hover:bg-yellow-500/10'
              "
              (aoClicar)="iniciarEdicaoFixo(fixo)"
            >
              ‚úé
            </app-botao>
          </div>
        </div>
      </div>
      <div
        *ngIf="fixosComStatus().length === 0"
        class="text-center py-10 text-slate-600 border-2 border-dashed border-slate-800 rounded-3xl"
      >
        Nenhum gasto fixo cadastrado.
      </div>
    </div>
  </div>
</section>
